{% extends "base.html" %}
{% load static %}

{% block content %}
<h1>Book a Lesson</h1>

<h2>Calendar for {{ month|stringformat:"02d" }}-{{ year }}</h2>

<div>
    <!-- Navigation links -->
    {% if month > 1 %}
        <a href="{% url 'book_a_lesson' %}?year={{ year }}&month={{ month|add:"-1" }}" class="nav-link">Previous Month</a>
    {% else %}
        <a href="{% url 'book_a_lesson' %}?year={{ year|add:"-1" }}&month=12" class="nav-link">Previous Month</a>
    {% endif %}
    
    {% if month < 12 %}
        <a href="{% url 'book_a_lesson' %}?year={{ year }}&month={{ month|add:"1" }}" class="nav-link">Next Month</a>
    {% else %}
        <a href="{% url 'book_a_lesson' %}?year={{ year|add:"1" }}&month=1" class="nav-link">Next Month</a>
    {% endif %}
</div>

<table>
    <thead>
        <tr>
            <th>Sun</th>
            <th>Mon</th>
            <th>Tue</th>
            <th>Wed</th>
            <th>Thu</th>
            <th>Fri</th>
            <th>Sat</th>
        </tr>
    </thead>
    <tbody>
        {% for week in month_days %}
        <tr>
            {% for day in week %}
            <td>
                {% if day %}
                {% with day|stringformat:'02d' as day_formatted %}
                {% with month|stringformat:'02d' as month_formatted %}
                {% with year|stringformat:'04d' as year_formatted %}
                <!-- Build the date string in YYYY-MM-DD format for proper URL parameter -->
                {% with date_str=year_formatted|add:"-"|add:month_formatted|add:"-"|add:day_formatted %}
                    <!-- Build the link URL -->
                    <a href="{% url 'timeslots_for_date' date=date_str %}">{{ day }}</a>
                {% endwith %}
                {% endwith %}
                {% endwith %}
                {% endwith %}
                {% endif %}
            </td>
            {% endfor %}
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}